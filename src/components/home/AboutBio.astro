---
import { mdToHtml } from "@/utils/markdown";

interface Props {
  bio: {
    heading: string;
    col1: string;
    col2: string;
    image?: any;
  };
}

const { bio } = Astro.props;

// Render markdown to HTML
const col1Html = mdToHtml(bio.col1);
const col2Html = mdToHtml(bio.col2);

// Determine layout based on image availability
const hasImage = bio.image && bio.image !== null;

// Handle both string path and object with src property
const imageSrc = typeof bio.image === 'string' ? bio.image : bio.image?.src;

// Create unified content array
const contentItems = [
  { type: 'text' as const, html: col1Html, field: 'about.col1' },
  { type: 'text' as const, html: col2Html, field: 'about.col2' },
  ...(hasImage && imageSrc ? [{
    type: 'image' as const,
    src: imageSrc,
    alt: '',
    field: 'about.image'
  }] : [])
];
---

<div>
  <!-- Heading extracted from grid -->
  <h2
    class="text-2xl font-brand-heading text-brand-dark uppercase mb-6 text-center reveal-text"
    data-delay="0"
    data-sb-field-path="about.heading"
  >
    {bio.heading}
  </h2>

  {
    hasImage ? (
      <!-- 3-column layout (text + text + image) -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-5 items-start">
        {contentItems.map((item, index) => (
          item.type === 'image' ? (
            <div class="relative flex items-end h-full mt-8 lg:mt-0 reveal-img" data-delay="300" data-sb-field-path={item.field}>
              <img
                src={item.src}
                alt={item.alt}
                class="w-full h-auto max-h-[400px] object-contain -mb-24 lg:-mb-32 scale-110 origin-bottom"
              />
            </div>
          ) : (
            <div
              class="text-sm font-book text-brand-dark leading-relaxed reveal-text [&>p:not(:last-child)]:mb-4"
              data-delay={`${(index + 1) * 100}`}
              set:html={item.html}
              data-sb-field-path={item.field}
            />
          )
        ))}
      </div>
    ) : (
      <!-- 2-column layout (text + text only) -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 items-start">
        {contentItems.map((item, index) => (
          <div
            class="text-sm font-book text-brand-dark leading-relaxed reveal-text [&>p:not(:last-child)]:mb-8"
            data-delay={`${(index + 1) * 100}`}
            set:html={item.html}
            data-sb-field-path={item.field}
          />
        ))}
      </div>
    )
  }
</div>
