---
import Markdoc from "@markdoc/markdoc";

interface Props {
  bio: {
    heading: string;
    col1: string;
    col2: string;
    image?: any;
  };
}

const { bio } = Astro.props;

// Render Markdoc strings to HTML
const col1Html = Markdoc.renderers.html(Markdoc.transform(Markdoc.parse(bio.col1)));
const col2Html = Markdoc.renderers.html(Markdoc.transform(Markdoc.parse(bio.col2)));

// Determine layout based on image availability
const hasImage = bio.image && bio.image !== null;

// Create unified content array
const contentItems = [
  { type: 'text' as const, html: col1Html },
  { type: 'text' as const, html: col2Html },
  ...(hasImage ? [{
    type: 'image' as const,
    src: bio.image.src,
    alt: ''
  }] : [])
];
---

<!-- Heading extracted from grid -->
<h2
  class="text-2xl font-brand-heading text-brand-dark uppercase mb-6 text-center"
>
  {bio.heading}
</h2>

{
  hasImage ? (
    <!-- 3-column layout (text + text + image) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-5 items-start">
      {contentItems.map((item) => (
        item.type === 'image' ? (
          <div class="relative flex items-end h-full">
            <img
              src={item.src}
              alt={item.alt}
              class="w-full h-auto object-contain -mb-24 lg:-mb-32 scale-110 origin-bottom"
            />
          </div>
        ) : (
          <div class="text-sm font-book text-brand-dark leading-relaxed" set:html={item.html} />
        )
      ))}
    </div>
  ) : (
    <!-- 2-column layout (text + text only) -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 items-start">
      {contentItems.map((item) => (
        <div class="text-sm font-book text-brand-dark leading-relaxed" set:html={item.html} />
      ))}
    </div>
  )
}
