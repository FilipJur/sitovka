---
import { DocumentRenderer } from '@keystatic/core/renderer';
import { Image } from "astro:assets";

interface Props {
  bio: {
    heading: string;
    col1: { node: any };  // markdoc.inline() structure
    col2: { node: any };
    image?: {
      src: string;
      width: number;
      height: number;
      format: string;
    };
  };
}

const { bio } = Astro.props;

// Parse Markdoc AST nodes to renderable format
// DocumentRenderer expects Element[], so we wrap the node in an array
const col1Ast = [bio.col1.node] as any;
const col2Ast = [bio.col2.node] as any;

// Determine layout based on image availability
const hasImage = bio.image !== undefined && bio.image !== null;
---

<!-- Heading extracted from grid -->
<h2
  class="text-2xl font-brand-heading text-brand-dark uppercase mb-6 text-center"
>
  {bio.heading}
</h2>

{
  hasImage ? (
    <!-- 3-column layout (text + text + image) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-5 items-start">
      <div class="text-sm font-book text-brand-dark leading-relaxed">
        <DocumentRenderer document={col1Ast} />
      </div>
      <div class="text-sm font-book text-brand-dark leading-relaxed">
        <DocumentRenderer document={col2Ast} />
      </div>
      <div class="relative flex items-end h-full">
        {bio.image && (
          <Image
            {...bio.image}
            alt="Bio image"
            class="w-full h-auto object-contain -mb-24 lg:-mb-32 scale-110 origin-bottom"
          />
        )}
      </div>
    </div>
  ) : (
    <!-- 2-column layout (text + text only) -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 items-start">
      <div class="text-sm font-book text-brand-dark leading-relaxed">
        <DocumentRenderer document={col1Ast} />
      </div>
      <div class="text-sm font-book text-brand-dark leading-relaxed">
        <DocumentRenderer document={col2Ast} />
      </div>
    </div>
  )
}
